<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<div>
<h:panelGroup rendered="#{user.isLoggedIn}">
    <h:outputText value="#{i18n['personalmessages.answer.from']} #{message.personalMessageRecipient.personalMessage.user.name}" /><br />
    <h:outputText value="#{i18n['personalmessages.answer.subject']} #{message.personalMessageRecipient.personalMessage.subject}" /><br />
    <h:form id="DeleteMessageForm">
        <h:panelGroup style="text-align: left">
            <rich:message style="color:red; line-height: 200%;" id="errorMessages" layout="list" ajaxRendered="false" />
        </h:panelGroup>
        <h:commandLink action="#{message.deletePMRMessage}">
            <h:outputText id="delemeMessageLink" value="#{i18n['personalmessages.answer.deletelink']}" />
        </h:commandLink>
    </h:form>
    <h:outputText value="#{i18n['personalmessages.answer.message']} #{message.personalMessageRecipient.personalMessage.body}" id="originalText" escape="false" /><br /><br />

    <h:panelGroup id="AnswerMessagePanel">
        <rich:panel header="#{i18n['personalmessages.answer.form.title']}" style="width: 600px" rendered="#{user.isLoggedIn and not message.isProcessed}">
            <h:panelGroup style="text-align: left">
                <!-- <rich:messages style="color:red; line-height: 200%;" id="errorMessages" layout="list" ajaxRendered="true" />  -->
                <rich:message for="messageAnswer" style="color:red; line-height: 200%;" id="errorAnswerMessages" layout="list" ajaxRendered="true" />
            </h:panelGroup>

            <h:form id="AnswerMessageForm">
                <h:inputTextarea style="width: 100%" rows="7" value="#{message.messageAnswerText}" id="messageAnswer" required="true" onclick="copyTextToEmptyElement(this)">
                    <rich:validator />
                </h:inputTextarea><br />
                <a4j:commandButton id="submitButton" value="#{i18n['personalmessages.answer.form.button.send']}" type="submit"
                    onclick="this.disabled=true"
                    oncomplete="document.getElementById('AnswerMessageForm:submitButton').disabled=false"
                    action="#{message.answerMessage}"
                    render="AnswerMessagePanel, MessageSuccessfullySent, LoggedOut" />
            </h:form>
        </rich:panel>
    </h:panelGroup>
    <script type="text/javascript">
        function copyTextToEmptyElement(element) {
        	var text = document.getElementById('originalText').innerHTML;
        	if (element.value == "") {
        	    element.value = '\n\n\n<br /><br /><br />-----<br />\n' + text;
        	    element.setSelectionRange(0,0);
        	}
        }
    </script>
</h:panelGroup>
</div>

</ui:composition>